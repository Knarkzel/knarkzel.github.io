<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><title>Variables and functions</title><link rel="stylesheet" href="/styles.css"/></head><body><table width="100%" cellpadding="0" cellspacing="0" border="0" id="header"><td align="left"><b>Variables and functions</b> | <a href=../>Go back</a></td><td align="right">Written by <a href="https://github.com/knarkzel">Knarkzel</a></td></table><div class="org-src-container">
<pre class="src src-shell"><span class="org-tree-sitter-hl-faceXpunctuationXspecial">$</span> <span class="org-tree-sitter-hl-faceXproperty">cargo</span> add rustyline-derive
    <span class="org-tree-sitter-hl-faceXfunctionXcall">Updating</span> crates.io index
      <span class="org-tree-sitter-hl-faceXfunctionXcall">Adding</span> rustyline-derive v0.7.0 to dependencies.
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span class="org-tree-sitter-hl-faceXkeyword">use</span> <span class="org-tree-sitter-hl-faceXconstant">anyhow</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-rainbow-delimiters-depth-1">{</span>anyhow, <span class="org-tree-sitter-hl-faceXconstructor">Result</span><span class="org-rainbow-delimiters-depth-1">}</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
<span class="org-tree-sitter-hl-faceXkeyword">use</span> <span class="org-tree-sitter-hl-faceXconstant">nom</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-tree-sitter-hl-faceXconstant">branch</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span>alt,
    <span class="org-tree-sitter-hl-faceXconstant">bytes</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstant">complete</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span>tag,
    <span class="org-tree-sitter-hl-faceXconstant">character</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstant">complete</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-rainbow-delimiters-depth-2">{</span>alpha1, digit1, multispace0, multispace1<span class="org-rainbow-delimiters-depth-2">}</span>,
    <span class="org-tree-sitter-hl-faceXconstant">combinator</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span>map,
    <span class="org-tree-sitter-hl-faceXconstant">multi</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-rainbow-delimiters-depth-2">{</span>many0, many1<span class="org-rainbow-delimiters-depth-2">}</span>,
    <span class="org-tree-sitter-hl-faceXconstant">sequence</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-rainbow-delimiters-depth-2">{</span>delimited, pair, preceded, separated_pair, terminated<span class="org-rainbow-delimiters-depth-2">}</span>,
    <span class="org-tree-sitter-hl-faceXconstructor">IResult</span>,
<span class="org-rainbow-delimiters-depth-1">}</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
<span class="org-tree-sitter-hl-faceXkeyword">use</span> <span class="org-tree-sitter-hl-faceXconstant">rustyline</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-rainbow-delimiters-depth-1">{</span><span class="org-tree-sitter-hl-faceXconstant">error</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">ReadlineError</span>, <span class="org-tree-sitter-hl-faceXconstant">validate</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">MatchingBracketValidator</span>, <span class="org-tree-sitter-hl-faceXconstructor">Editor</span><span class="org-rainbow-delimiters-depth-1">}</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
<span class="org-tree-sitter-hl-faceXkeyword">use</span> <span class="org-tree-sitter-hl-faceXconstant">rustyline_derive</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-rainbow-delimiters-depth-1">{</span><span class="org-tree-sitter-hl-faceXconstructor">Completer</span>, <span class="org-tree-sitter-hl-faceXconstructor">Helper</span>, <span class="org-tree-sitter-hl-faceXconstructor">Highlighter</span>, <span class="org-tree-sitter-hl-faceXconstructor">Hinter</span>, <span class="org-tree-sitter-hl-faceXconstructor">Validator</span><span class="org-rainbow-delimiters-depth-1">}</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
<span class="org-tree-sitter-hl-faceXkeyword">use</span> <span class="org-tree-sitter-hl-faceXconstant">std</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstant">collections</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">HashMap</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>

<span class="org-tree-sitter-hl-faceXcomment">// Parser</span>
<span class="org-tree-sitter-hl-faceXattribute">#</span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">[</span></span></span><span class="org-tree-sitter-hl-faceXattribute">derive</span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span></span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXconstructor">Debug</span></span><span class="org-tree-sitter-hl-faceXattribute">, </span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXconstructor">Clone</span></span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span></span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">]</span></span></span>
<span class="org-tree-sitter-hl-faceXkeyword">enum</span> <span class="org-tree-sitter-hl-faceXtype">Operator</span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-tree-sitter-hl-faceXconstructor">Plus</span>,
    <span class="org-tree-sitter-hl-faceXconstructor">Minus</span>,
    <span class="org-tree-sitter-hl-faceXconstructor">Divide</span>,
    <span class="org-tree-sitter-hl-faceXconstructor">Multiply</span>,
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-tree-sitter-hl-faceXattribute">#</span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">[</span></span></span><span class="org-tree-sitter-hl-faceXattribute">derive</span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span></span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXconstructor">Debug</span></span><span class="org-tree-sitter-hl-faceXattribute">, </span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXconstructor">Clone</span></span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span></span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">]</span></span></span>
<span class="org-tree-sitter-hl-faceXkeyword">enum</span> <span class="org-tree-sitter-hl-faceXtype">Atom</span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-tree-sitter-hl-faceXconstructor">Number</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">isize</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>,
    <span class="org-tree-sitter-hl-faceXconstructor">Operator</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXtype">Operator</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>,
    <span class="org-tree-sitter-hl-faceXconstructor">Symbol</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXtype">String</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>,
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-tree-sitter-hl-faceXcomment">// Atom</span>
<span class="org-tree-sitter-hl-faceXkeyword">fn</span> <span class="org-tree-sitter-hl-faceXfunction">operator</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-tree-sitter-hl-faceXvariableXparameter">input</span>: <span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">)</span></span> -&gt; <span class="org-tree-sitter-hl-faceXtype">IResult</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span>, <span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">Atom</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">plus</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">map</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXfunctionXcall">tag</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXstring">"+"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span>, |_| <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Operator</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Plus</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">minus</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">map</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXfunctionXcall">tag</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXstring">"-"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span>, |_| <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Operator</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Minus</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">divide</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">map</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXfunctionXcall">tag</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXstring">"/"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span>, |_| <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Operator</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Divide</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">multiply</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">map</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXfunctionXcall">tag</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXstring">"*"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span>, |_| <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Operator</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Multiply</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall">map</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXfunctionXcall">alt</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span>plus, minus, divide, multiply<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span>, <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Atom</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Operator</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)(</span></span>input<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-tree-sitter-hl-faceXkeyword">fn</span> <span class="org-tree-sitter-hl-faceXfunction">number</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-tree-sitter-hl-faceXvariableXparameter">input</span>: <span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">)</span></span> -&gt; <span class="org-tree-sitter-hl-faceXtype">IResult</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span>, <span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">Atom</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall">map</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span>digit1, |<span class="org-tree-sitter-hl-faceXvariableXparameter">digits</span>: <span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span>| <span class="org-rainbow-delimiters-depth-3">{</span>
        <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Atom</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXfunctionXcall"><span class="org-tree-sitter-hl-faceXconstructor">Number</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span>digits<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">parse</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">&lt;</span></span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">isize</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">&gt;()</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">unwrap</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">()</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span>
    <span class="org-rainbow-delimiters-depth-3">}</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)(</span></span>input<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-tree-sitter-hl-faceXkeyword">fn</span> <span class="org-tree-sitter-hl-faceXfunction">symbol</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-tree-sitter-hl-faceXvariableXparameter">input</span>: <span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">)</span></span> -&gt; <span class="org-tree-sitter-hl-faceXtype">IResult</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span>, <span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">Atom</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall">map</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span>alpha1, |<span class="org-tree-sitter-hl-faceXvariableXparameter">name</span>: <span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span>| <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Atom</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXfunctionXcall"><span class="org-tree-sitter-hl-faceXconstructor">Symbol</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span>name<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">to_string</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">()</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)(</span></span>input<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-tree-sitter-hl-faceXkeyword">fn</span> <span class="org-tree-sitter-hl-faceXfunction">atom</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-tree-sitter-hl-faceXvariableXparameter">input</span>: <span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">)</span></span> -&gt; <span class="org-tree-sitter-hl-faceXtype">IResult</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span>, <span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">Atom</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">options</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">alt</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span>symbol, operator, number<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall">delimited</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span>multispace0, options, multispace0<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)(</span></span>input<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-tree-sitter-hl-faceXcomment">// Expr</span>
<span class="org-tree-sitter-hl-faceXattribute">#</span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">[</span></span></span><span class="org-tree-sitter-hl-faceXattribute">derive</span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span></span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXconstructor">Debug</span></span><span class="org-tree-sitter-hl-faceXattribute">, </span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXconstructor">Clone</span></span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span></span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">]</span></span></span>
<span class="org-tree-sitter-hl-faceXkeyword">enum</span> <span class="org-tree-sitter-hl-faceXtype">Expr</span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-tree-sitter-hl-faceXconstructor">Constant</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXtype">Atom</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>,
    <span class="org-tree-sitter-hl-faceXconstructor">Define</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXtype">Atom</span>, <span class="org-tree-sitter-hl-faceXtype">Box</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">&lt;</span></span><span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">Expr</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">&gt;</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>,
    <span class="org-tree-sitter-hl-faceXconstructor">Call</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXtype">Box</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">&lt;</span></span><span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">Expr</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">&gt;</span></span>, <span class="org-tree-sitter-hl-faceXtype">Vec</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">&lt;</span></span><span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">Expr</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">&gt;</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>,
    <span class="org-tree-sitter-hl-faceXconstructor">Lambda</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXtype">Vec</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">&lt;</span></span><span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">Atom</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">&gt;</span></span>, <span class="org-tree-sitter-hl-faceXtype">Box</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">&lt;</span></span><span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">Expr</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">&gt;</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>,
    <span class="org-tree-sitter-hl-faceXconstructor">Nil</span>,
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-tree-sitter-hl-faceXkeyword">fn</span> <span class="org-tree-sitter-hl-faceXfunction">constant</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-tree-sitter-hl-faceXvariableXparameter">input</span>: <span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">)</span></span> -&gt; <span class="org-tree-sitter-hl-faceXtype">IResult</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span>, <span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">Expr</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall">map</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span>atom, <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Expr</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Constant</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)(</span></span>input<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-tree-sitter-hl-faceXkeyword">fn</span> <span class="org-tree-sitter-hl-faceXfunction">call</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-tree-sitter-hl-faceXvariableXparameter">input</span>: <span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">)</span></span> -&gt; <span class="org-tree-sitter-hl-faceXtype">IResult</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span>, <span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">Expr</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">form</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">pair</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span>expr, <span class="org-tree-sitter-hl-faceXfunctionXcall">many0</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span>expr<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">call</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">map</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span>form, |<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span>head, tail<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span>| <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Expr</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXfunctionXcall"><span class="org-tree-sitter-hl-faceXconstructor">Call</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Box</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXfunctionXcall">new</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span>head<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span>, tail<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall">delimited</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXfunctionXcall">tag</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXstring">"("</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span>, call, <span class="org-tree-sitter-hl-faceXfunctionXcall">tag</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXstring">")"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)(</span></span>input<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-tree-sitter-hl-faceXkeyword">fn</span> <span class="org-tree-sitter-hl-faceXfunction">define</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-tree-sitter-hl-faceXvariableXparameter">input</span>: <span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">)</span></span> -&gt; <span class="org-tree-sitter-hl-faceXtype">IResult</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span>, <span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">Expr</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">form</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">preceded</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXfunctionXcall">tag</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXstring">"define"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span>, <span class="org-tree-sitter-hl-faceXfunctionXcall">pair</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span>atom, expr<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">define</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">map</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span>form, |<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span>name, value<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span>| <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Expr</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXfunctionXcall"><span class="org-tree-sitter-hl-faceXconstructor">Define</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span>name, <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Box</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXfunctionXcall">new</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span>value<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall">delimited</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXfunctionXcall">tag</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXstring">"("</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span>, define, <span class="org-tree-sitter-hl-faceXfunctionXcall">tag</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXstring">")"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)(</span></span>input<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-tree-sitter-hl-faceXkeyword">fn</span> <span class="org-tree-sitter-hl-faceXfunction">lambda</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-tree-sitter-hl-faceXvariableXparameter">input</span>: <span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">)</span></span> -&gt; <span class="org-tree-sitter-hl-faceXtype">IResult</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span>, <span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">Expr</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">args</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">delimited</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXfunctionXcall">tag</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXstring">"("</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span>, <span class="org-tree-sitter-hl-faceXfunctionXcall">many0</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span>atom<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span>, <span class="org-tree-sitter-hl-faceXfunctionXcall">tag</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXstring">")"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">form</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">preceded</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span>
        <span class="org-tree-sitter-hl-faceXfunctionXcall">terminated</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXfunctionXcall">tag</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span><span class="org-tree-sitter-hl-faceXstring">"lambda"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span>, multispace1<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span>,
        <span class="org-tree-sitter-hl-faceXfunctionXcall">separated_pair</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span>args, multispace1, expr<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span>,
    <span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">lambda</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">map</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span>form, |<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span>args, body<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span>| <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Expr</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXfunctionXcall"><span class="org-tree-sitter-hl-faceXconstructor">Lambda</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span>args, <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Box</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXfunctionXcall">new</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span>body<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall">delimited</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXfunctionXcall">tag</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXstring">"("</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span>, lambda, <span class="org-tree-sitter-hl-faceXfunctionXcall">tag</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXstring">")"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)(</span></span>input<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-tree-sitter-hl-faceXkeyword">fn</span> <span class="org-tree-sitter-hl-faceXfunction">expr</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-tree-sitter-hl-faceXvariableXparameter">input</span>: <span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">)</span></span> -&gt; <span class="org-tree-sitter-hl-faceXtype">IResult</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span>, <span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">Expr</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall">alt</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span>define, call, lambda, constant<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)(</span></span>input<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-tree-sitter-hl-faceXcomment">// Final parser</span>
<span class="org-tree-sitter-hl-faceXkeyword">fn</span> <span class="org-tree-sitter-hl-faceXfunction">parse</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-tree-sitter-hl-faceXvariableXparameter">input</span>: <span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">)</span></span> -&gt; <span class="org-tree-sitter-hl-faceXtype">IResult</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">str</span>, <span class="org-tree-sitter-hl-faceXtype">Vec</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">&lt;</span></span><span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">Expr</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">&gt;</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall">many1</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXfunctionXcall">delimited</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span>multispace0, expr, multispace0<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)(</span></span>input<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-tree-sitter-hl-faceXcomment">// Helpers</span>
<span class="org-tree-sitter-hl-faceXkeyword">fn</span> <span class="org-tree-sitter-hl-faceXfunction">exprs_to_numbers</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-tree-sitter-hl-faceXvariableXparameter">exprs</span>: <span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">[</span></span><span class="org-tree-sitter-hl-faceXtype">Expr</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">]</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">)</span></span> -&gt; <span class="org-tree-sitter-hl-faceXtype">Result</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-tree-sitter-hl-faceXtype">Vec</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">&lt;</span></span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">isize</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">&gt;</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">numbers</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> exprs
        <span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">iter</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">()</span></span>
        <span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">map</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span>|expr| <span class="org-tree-sitter-hl-faceXkeyword">match</span> expr <span class="org-rainbow-delimiters-depth-3">{</span>
            <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Expr</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Constant</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span><span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Atom</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Number</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">(</span></span>number<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span> =&gt; <span class="org-tree-sitter-hl-faceXfunctionXcall"><span class="org-tree-sitter-hl-faceXconstructor">Ok</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span><span class="org-tree-sitter-hl-faceXoperator">*</span>number<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span>,
            atom =&gt; <span class="org-tree-sitter-hl-faceXfunctionXcall"><span class="org-tree-sitter-hl-faceXconstructor">Err</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span><span class="org-tree-sitter-hl-faceXfunctionXmacro">anyhow!</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">(</span></span><span class="org-tree-sitter-hl-faceXstring">"Expected number, got {atom:?}"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span>,
        <span class="org-rainbow-delimiters-depth-3">}</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>
        <span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">collect</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">&lt;</span></span><span class="org-tree-sitter-hl-faceXtype">Result</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">&lt;</span></span><span class="org-tree-sitter-hl-faceXtype">Vec</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">&lt;</span></span><span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">_</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">&gt;</span></span>, <span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">_</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">&gt;</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">&gt;()</span></span><span class="org-tree-sitter-hl-faceXoperator">?</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall"><span class="org-tree-sitter-hl-faceXconstructor">Ok</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span>numbers<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-tree-sitter-hl-faceXcomment">// Evaluator</span>
<span class="org-tree-sitter-hl-faceXkeyword">fn</span> <span class="org-tree-sitter-hl-faceXfunction">eval</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-tree-sitter-hl-faceXvariableXparameter">expr</span>: <span class="org-tree-sitter-hl-faceXtype">Expr</span>, <span class="org-tree-sitter-hl-faceXvariableXparameter">environment</span>: <span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXkeyword">mut</span> <span class="org-tree-sitter-hl-faceXtype">HashMap</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">&lt;</span></span><span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">String</span></span>, <span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">Expr</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">&gt;</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">)</span></span> -&gt; <span class="org-tree-sitter-hl-faceXtype">Result</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">Expr</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">output</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXkeyword">match</span> expr <span class="org-rainbow-delimiters-depth-2">{</span>
        <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Expr</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Constant</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Atom</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Symbol</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span>name<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span> =&gt; environment
            <span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">get</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXoperator">&amp;</span>name<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span>
            <span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">ok_or_else</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span>|| <span class="org-tree-sitter-hl-faceXfunctionXmacro">anyhow!</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span><span class="org-tree-sitter-hl-faceXstring">"`{name}` is not defined"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tree-sitter-hl-faceXoperator">?</span>
            <span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">clone</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">()</span></span>,
        <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Expr</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Define</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Atom</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Symbol</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span>name<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span>, value<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span> =&gt; <span class="org-rainbow-delimiters-depth-3">{</span>
            <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">value</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">eval</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span><span class="org-tree-sitter-hl-faceXoperator">*</span>value, environment<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span><span class="org-tree-sitter-hl-faceXoperator">?</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
            environment<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">insert</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span>name, value<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
            <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Expr</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Nil</span>
        <span class="org-rainbow-delimiters-depth-3">}</span>
        <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Expr</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Call</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span>head, tail<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span> =&gt; <span class="org-rainbow-delimiters-depth-3">{</span>
            <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">head</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">eval</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span><span class="org-tree-sitter-hl-faceXoperator">*</span>head, environment<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span><span class="org-tree-sitter-hl-faceXoperator">?</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
            <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">tail</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> tail
                <span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">into_iter</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">()</span></span>
                <span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">map</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span>|expr| <span class="org-tree-sitter-hl-faceXfunctionXcall">eval</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">(</span></span>expr, environment<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span>
                <span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">collect</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">&lt;</span></span><span class="org-tree-sitter-hl-faceXtype">Result</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">&lt;</span></span><span class="org-tree-sitter-hl-faceXtype">Vec</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">&lt;</span></span><span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">_</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">&gt;</span></span>, <span class="org-tree-sitter-hl-faceXtype"><span class="org-tree-sitter-hl-faceXtypeXargument">_</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">&gt;</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">&gt;()</span></span><span class="org-tree-sitter-hl-faceXoperator">?</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
            <span class="org-tree-sitter-hl-faceXkeyword">match</span> head <span class="org-rainbow-delimiters-depth-4">{</span>
                <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Expr</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Constant</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">(</span></span><span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Atom</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Operator</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">(</span></span>operator<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">)</span></span> =&gt; <span class="org-rainbow-delimiters-depth-5">{</span>
                    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">numbers</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">exprs_to_numbers</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">(</span></span><span class="org-tree-sitter-hl-faceXoperator">&amp;</span>tail<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">)</span></span><span class="org-tree-sitter-hl-faceXoperator">?</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">total</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> numbers
                        <span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">into_iter</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">()</span></span>
                        <span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">reduce</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">(</span></span>|total, number| <span class="org-tree-sitter-hl-faceXkeyword">match</span> operator <span class="org-rainbow-delimiters-depth-7">{</span>
                            <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Operator</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Plus</span> =&gt; total <span class="org-tree-sitter-hl-faceXoperator">+</span> number,
                            <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Operator</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Minus</span> =&gt; total <span class="org-tree-sitter-hl-faceXoperator">-</span> number,
                            <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Operator</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Divide</span> =&gt; total <span class="org-tree-sitter-hl-faceXoperator">/</span> number,
                            <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Operator</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Multiply</span> =&gt; total <span class="org-tree-sitter-hl-faceXoperator">*</span> number,
                        <span class="org-rainbow-delimiters-depth-7">}</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">)</span></span>
                        <span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">ok_or_else</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">(</span></span>|| <span class="org-tree-sitter-hl-faceXfunctionXmacro">anyhow!</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-7">(</span></span><span class="org-tree-sitter-hl-faceXstring">"Tail is empty"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-7">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">)</span></span><span class="org-tree-sitter-hl-faceXoperator">?</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                    <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Expr</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXfunctionXcall"><span class="org-tree-sitter-hl-faceXconstructor">Constant</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">(</span></span><span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Atom</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXfunctionXcall"><span class="org-tree-sitter-hl-faceXconstructor">Number</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-7">(</span></span>total<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-7">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">)</span></span>
                <span class="org-rainbow-delimiters-depth-5">}</span>
                <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Expr</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Lambda</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">(</span></span>args, body<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">)</span></span> =&gt; <span class="org-rainbow-delimiters-depth-5">{</span>
                    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">scope</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> environment<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">clone</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">()</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                    <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">(</span></span><span class="org-tree-sitter-hl-faceXvariable">arg</span>, <span class="org-tree-sitter-hl-faceXvariable">expr</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">)</span></span> <span class="org-tree-sitter-hl-faceXkeyword">in</span> args<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">into_iter</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">()</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">zip</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">(</span></span>tail<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">into_iter</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-7">()</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">)</span></span> <span class="org-rainbow-delimiters-depth-6">{</span>
                        <span class="org-tree-sitter-hl-faceXkeyword">match</span> arg <span class="org-rainbow-delimiters-depth-7">{</span>
                            <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Atom</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Symbol</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-8">(</span></span>name<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-8">)</span></span> =&gt; <span class="org-rainbow-delimiters-depth-8">{</span>
                                environment<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">insert</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-9">(</span></span>name, expr<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-9">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                            <span class="org-rainbow-delimiters-depth-8">}</span>
                            _ =&gt; <span class="org-tree-sitter-hl-faceXkeyword">return</span> <span class="org-tree-sitter-hl-faceXfunctionXcall"><span class="org-tree-sitter-hl-faceXconstructor">Err</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-8">(</span></span><span class="org-tree-sitter-hl-faceXfunctionXmacro">anyhow!</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-9">(</span></span><span class="org-tree-sitter-hl-faceXstring">"Invalid symbol: {arg:?}"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-9">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-8">)</span></span>,
                        <span class="org-rainbow-delimiters-depth-7">}</span>
                    <span class="org-rainbow-delimiters-depth-6">}</span>
                    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">output</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">eval</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">(</span></span><span class="org-tree-sitter-hl-faceXoperator">*</span>body, environment<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">)</span></span><span class="org-tree-sitter-hl-faceXoperator">?</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                    <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXvariable">environment</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> scope<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                    output
                <span class="org-rainbow-delimiters-depth-5">}</span>
                _ =&gt; <span class="org-tree-sitter-hl-faceXkeyword">return</span> <span class="org-tree-sitter-hl-faceXfunctionXcall"><span class="org-tree-sitter-hl-faceXconstructor">Err</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">(</span></span><span class="org-tree-sitter-hl-faceXfunctionXmacro">anyhow!</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">(</span></span><span class="org-tree-sitter-hl-faceXstring">"Invalid function: {head:?}"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">)</span></span>,
            <span class="org-rainbow-delimiters-depth-4">}</span>
        <span class="org-rainbow-delimiters-depth-3">}</span>
        <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Expr</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Lambda</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span>_, _<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span> | <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Expr</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Constant</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span>_<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span> | <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Expr</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Nil</span> =&gt; expr,
        _ =&gt; <span class="org-tree-sitter-hl-faceXkeyword">return</span> <span class="org-tree-sitter-hl-faceXfunctionXcall"><span class="org-tree-sitter-hl-faceXconstructor">Err</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXfunctionXmacro">anyhow!</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span><span class="org-tree-sitter-hl-faceXstring">"Invalid expression: {expr:?}"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span>,
    <span class="org-rainbow-delimiters-depth-2">}</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall"><span class="org-tree-sitter-hl-faceXconstructor">Ok</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span>output<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-tree-sitter-hl-faceXcomment">// Rustyline</span>
<span class="org-tree-sitter-hl-faceXattribute">#</span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">[</span></span></span><span class="org-tree-sitter-hl-faceXattribute">derive</span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span></span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXconstructor">Helper</span></span><span class="org-tree-sitter-hl-faceXattribute">, </span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXconstructor">Completer</span></span><span class="org-tree-sitter-hl-faceXattribute">, </span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXconstructor">Hinter</span></span><span class="org-tree-sitter-hl-faceXattribute">, </span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXconstructor">Validator</span></span><span class="org-tree-sitter-hl-faceXattribute">, </span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXconstructor">Highlighter</span></span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span></span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">]</span></span></span>
<span class="org-tree-sitter-hl-faceXkeyword">struct</span> <span class="org-tree-sitter-hl-faceXtype">Helper</span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-tree-sitter-hl-faceXattribute">#</span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">[</span></span></span><span class="org-tree-sitter-hl-faceXattribute">rustyline</span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span></span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXconstructor">Validator</span></span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span></span><span class="org-tree-sitter-hl-faceXattribute"><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">]</span></span></span>
    <span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXpropertyXdefinition">validator</span></span>: <span class="org-tree-sitter-hl-faceXtype">MatchingBracketValidator</span>,
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-tree-sitter-hl-faceXkeyword">fn</span> <span class="org-tree-sitter-hl-faceXfunction">main</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">()</span></span> -&gt; <span class="org-tree-sitter-hl-faceXtype">Result</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">()</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-tree-sitter-hl-faceXcomment">// Create rustyline editor</span>
    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXkeyword">mut</span> <span class="org-tree-sitter-hl-faceXvariable">editor</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">Editor</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXfunctionXcall">new</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">()</span></span><span class="org-tree-sitter-hl-faceXoperator">?</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">helper</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXtype">Helper</span> <span class="org-rainbow-delimiters-depth-2">{</span>
        <span class="org-tree-sitter-hl-faceXproperty">validator</span>: <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">MatchingBracketValidator</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXfunctionXcall">new</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">()</span></span>,
    <span class="org-rainbow-delimiters-depth-2">}</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    editor<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">set_helper</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXfunctionXcall"><span class="org-tree-sitter-hl-faceXconstructor">Some</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span>helper<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>

    <span class="org-tree-sitter-hl-faceXcomment">// Read lines and eval them</span>
    <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXkeyword">mut</span> <span class="org-tree-sitter-hl-faceXvariable">environment</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">HashMap</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXfunctionXcall">new</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">()</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXkeyword">loop</span> <span class="org-rainbow-delimiters-depth-2">{</span>
        <span class="org-tree-sitter-hl-faceXkeyword">match</span> editor<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXmethodXcall">readline</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-tree-sitter-hl-faceXstring">"&gt;&gt; "</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">)</span></span> <span class="org-rainbow-delimiters-depth-3">{</span>
            <span class="org-tree-sitter-hl-faceXconstructor">Ok</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span>input<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span> =&gt; <span class="org-tree-sitter-hl-faceXkeyword">match</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">parse</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span><span class="org-tree-sitter-hl-faceXoperator">&amp;</span>input<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span> <span class="org-rainbow-delimiters-depth-4">{</span>
                <span class="org-tree-sitter-hl-faceXconstructor">Ok</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">(</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">(</span></span>_, exprs<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-6">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">)</span></span> =&gt; <span class="org-rainbow-delimiters-depth-5">{</span>
                    <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXvariable">expr</span> <span class="org-tree-sitter-hl-faceXkeyword">in</span> exprs <span class="org-rainbow-delimiters-depth-6">{</span>
                        <span class="org-tree-sitter-hl-faceXkeyword">let</span> <span class="org-tree-sitter-hl-faceXvariable">output</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">eval</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-7">(</span></span>expr, <span class="org-tree-sitter-hl-faceXoperator">&amp;</span><span class="org-tree-sitter-hl-faceXkeyword">mut</span> environment<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-7">)</span></span><span class="org-tree-sitter-hl-faceXoperator">?</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                        <span class="org-tree-sitter-hl-faceXfunctionXmacro">println!</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-7">(</span></span><span class="org-tree-sitter-hl-faceXstring">"{output:?}"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-7">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                    <span class="org-rainbow-delimiters-depth-6">}</span>
                <span class="org-rainbow-delimiters-depth-5">}</span>
                <span class="org-tree-sitter-hl-faceXconstructor">Err</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">(</span></span>error<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">)</span></span> =&gt; <span class="org-tree-sitter-hl-faceXfunctionXmacro">println!</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">(</span></span><span class="org-tree-sitter-hl-faceXstring">"{error}"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">)</span></span>,
            <span class="org-rainbow-delimiters-depth-4">}</span>,
            <span class="org-tree-sitter-hl-faceXconstructor">Err</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span><span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">ReadlineError</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Interrupted</span> | <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXconstructor"><span class="org-tree-sitter-hl-faceXtype">ReadlineError</span></span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">::</span><span class="org-tree-sitter-hl-faceXconstructor">Eof</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span> =&gt; <span class="org-tree-sitter-hl-faceXkeyword">break</span>,
            <span class="org-tree-sitter-hl-faceXconstructor">Err</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">(</span></span>error<span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-4">)</span></span> =&gt; <span class="org-rainbow-delimiters-depth-4">{</span>
                <span class="org-tree-sitter-hl-faceXfunctionXmacro">println!</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">(</span></span><span class="org-tree-sitter-hl-faceXstring">"Error: {error}"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-5">)</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                <span class="org-tree-sitter-hl-faceXkeyword">break</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
            <span class="org-rainbow-delimiters-depth-4">}</span>
        <span class="org-rainbow-delimiters-depth-3">}</span>
    <span class="org-rainbow-delimiters-depth-2">}</span>

    <span class="org-tree-sitter-hl-faceXfunctionXcall"><span class="org-tree-sitter-hl-faceXconstructor">Ok</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-3">()</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket"><span class="org-rainbow-delimiters-depth-2">)</span></span>
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-tree-sitter-hl-faceXpunctuationXspecial">$</span> <span class="org-tree-sitter-hl-faceXproperty">cargo</span> run
    <span class="org-tree-sitter-hl-faceXfunctionXcall">Finished</span> dev <span class="org-rainbow-delimiters-depth-1">[</span>unoptimized + debuginfo<span class="org-rainbow-delimiters-depth-1">]</span> target<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-tree-sitter-hl-faceXfunctionXcall">s</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-tree-sitter-hl-faceXkeyword">in</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">0.37s</span>
     <span class="org-tree-sitter-hl-faceXfunctionXcall">Running</span> <span class="org-tree-sitter-hl-faceXpunctuationXspecial">`</span><span class="org-tree-sitter-hl-faceXembedded"><span class="org-tree-sitter-hl-faceXfunctionXcall">target/debug/lisp</span></span><span class="org-tree-sitter-hl-faceXpunctuationXspecial">`</span>
<span class="org-tree-sitter-hl-faceXoperator">&gt;&gt;</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-tree-sitter-hl-faceXfunctionXcall">define</span> x 10<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-tree-sitter-hl-faceXfunctionXcall">Nil</span>
<span class="org-tree-sitter-hl-faceXoperator">&gt;&gt;</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-tree-sitter-hl-faceXfunctionXcall">+</span> x 20<span class="org-rainbow-delimiters-depth-1">)</span>
Constant<span class="org-rainbow-delimiters-depth-1">(</span>Number<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-tree-sitter-hl-faceXfunctionXcall">30</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-tree-sitter-hl-faceXoperator">&gt;&gt;</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-tree-sitter-hl-faceXfunctionXcall">*</span> x x<span class="org-rainbow-delimiters-depth-1">)</span>
Constant<span class="org-rainbow-delimiters-depth-1">(</span>Number<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-tree-sitter-hl-faceXfunctionXcall">100</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-tree-sitter-hl-faceXoperator">&gt;&gt;</span> <span class="org-rainbow-delimiters-depth-1">(</span>define <span class="org-tree-sitter-hl-faceXfunctionXcall">add</span> <span class="org-rainbow-delimiters-depth-2">(</span>lambda <span class="org-rainbow-delimiters-depth-3">(</span>x y<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-tree-sitter-hl-faceXfunctionXcall">+</span> x y<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-tree-sitter-hl-faceXfunctionXcall">Nil</span>
<span class="org-tree-sitter-hl-faceXoperator">&gt;&gt;</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-tree-sitter-hl-faceXfunctionXcall">add</span> 5 10<span class="org-rainbow-delimiters-depth-1">)</span>
Constant<span class="org-rainbow-delimiters-depth-1">(</span>Number<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-tree-sitter-hl-faceXfunctionXcall">15</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<pre>
lisp
├── src
│   └── <a href="./lisp/src/main.rs">main.rs</a>
├── <a href="./lisp/Cargo.lock">Cargo.lock</a>
└── <a href="./lisp/Cargo.toml">Cargo.toml</a>
</pre>
</body></html>
